# Mysql

## 数据库基础

### 数据保存差异

#### 内存

优点：存取速度快

缺点：数据不能永久做保存

#### 数据保存在文件

优点：数据永久保存

缺点：速度慢，频繁的IO操作，查询数据不方便

#### 数据库

数据能永久保存

通过sql就能很方便的查询出来

管理数据方便

### 数据库三大范式

第一范式：每个列不可拆分

第二范式：在第一范式的基础上，非主键的列完全依赖于主键，而不是依赖主键的一部分

第三范式：在第二方式的基础上，非主键列只依赖于主键，不依赖于其他非主键

在设计数据库结构的时候，要尽量遵守三范式，如果不准守，必须要有足够的理由，比如性能。

### mysql有关权限的表

user：记录连接服务器的账户信息

db:记录账号在各个数据库上的操作权限

table_priv:记录数据表级的操作的权限

columns_priv:记录数据列级的操作权限

host:配合db对给定主机上数据库级操作权限作更细致的控制

### binlog录入格式

statement:记录每一条会修改数据的sql，会保存sql的上下文，但是不会记录函数之类的语句

row：不记录sql上下文，只保存哪条记录被修改，记录每一行的改动，但是日志量会很大

mixed:这种方案，普通操作用statement，无法使用statement时使用row

## 数据类型

mysql数据类型

| 分类             | 类型名称     | 说明                        |
| ---------------- | ------------ | --------------------------- |
| 整数类型         | tinyint      | 很小的整数（8位2进制）      |
|                  | smalint      | 小的整数（16位2进制）       |
|                  | mediumint    | 中等大小的整数（24位2进制） |
|                  | int          | 普通大小的整数（32位2进制） |
| 小数类型         | float        | 单精度类型                  |
|                  | double       | 双精度类型                  |
|                  | decimal      | 压缩严格的定点数            |
| 日期类型         | year         | YYYY                        |
|                  | time         | HH:mm:ss                    |
|                  | date         | yyyy-MM-dd                  |
|                  | datetime     | yyyy-MM-dd HH:mm:ss         |
|                  | timestamp    | 时间戳                      |
| 文本、二进制类型 | char(m)      | m为0-255之间的整数          |
|                  | varchar（m） | m为0-65535之间的整数        |
|                  | tinyblob     | 最大长度为255字节           |
|                  | blob         | 最大长度为65535字节         |
|                  | mediumblob   | 最大长度为167772150字节     |
|                  | longblob     | 最大长度为4294967295字节    |
|                  | tinytext     | 最大长度为255字节           |
|                  | text         | 最大长度为65535字节         |
|                  | mediumtext   | 最大长度为167772150字节     |
|                  | longtext     | 最大长度为4294967295字节    |
|                  | varbinary(m) | m个字节的变长字节字符串     |
|                  | binary(m)    | m个字节的定长字节字符串     |

注意事项：

1. int(5)做填充0的数据时，可以使用属性**UNSIGNED ZEROFILL **，这样插入数据为12时，实际存储为00012
2. varchar存储的内容超出长度后会被截断（一般java中sql会报错）
3. 对于经常变更的数据来说，char比varchar更好，因为char不容易产生碎片
4. 非常短的列，char比varchar更有效率
5. 尽量避免使用text/blob字段，查询时会使用临时表，导致严重的性能开销
6. 日期上使用尽量使用timestemp，效率高于datetime

## 引擎

### myISAM和InnoDB区别

InnoDB:提供对数据库ACID事务的支持，并且还提供了行级锁和外键的约束

myISAM：不提供事务支持，也不支持行级锁和外键

MEMORY：所有引擎里效率最高，但是安全性不高

### InnoDB引擎的4大特性

+ 插入缓冲
+ 二次写
+ 自适应哈希索引
+ 预读

## 索引

索引是一种数据结构。数据库索引，是数据库管理系统中的一个排序的数据结构，以协助快速查询、更新数据库表中数据。索引的实现一般是通过B树或者B+树。

索引也可以看成是一个目录，它是要占据物理空间的

### 索引的优缺点

优点：

+ 加快数据的检索速度
+ 使用优化隐藏器，提高系统性能

缺点：

+ 创建和维护要耗费时间（对表做新增和删除时效率低）
+ 占用物理空间

### 索引的使用场景

#### where

在where条件中使用索引可以加快查询效率

#### order by

如果未建立索引，那么将查询所有数据然后进行外部排序，但是建立了索引，因为索引是有序的，所以查询会大大加快

#### join

对join语句匹配关系（on）创建索引会提高效率

#### 索引覆盖

如果要查询的字段都建立过索引，那么引擎会直接在索引表中查询而不会访问原始数据（否则只要有一个字段没有建立索引就会做全表扫描），这叫索引覆盖，在select后只写必要的查询字段，以增加索引覆盖的几率

### 索引的种类

#### 主键索引

每个表唯一，不能为NULL，数据列不允许重复

#### 唯一索引

列不允许重复，允许为NULL，可以创建多个，也可以创建联合唯一索引

#### 普通索引

基本索引类型，没有唯一性限制，可以为NULL

#### 全文索引

是目前搜索引擎使用的一种关键技术。

### 索引的数据结构（B树，hash）

