# mysql知识点整理

## 锁

### 锁粒度分类

+ 行级锁

  粒度最细的锁，只针对当前操作的行进行加锁。

  特点：**开销大，加锁慢，会出现死锁。粒度小，发生锁冲突概率低，并发度高**

+ 表级锁

  粒度最大的锁，对当前操作的表进行加锁

  特点：**开销小，加锁快，不会出现死锁。粒度大，发生锁冲突概率高，并发度低**

+ 页级锁

  粒度介于行级锁和页级锁中间的锁，锁定数据相邻的一组数据（间隙锁？）

  特点：**开销和加锁时间界于表锁和行锁之间。会出现死锁。并发度一般**

### 锁类别分类

+ 共享锁

  读锁。用户对数据读取时，对数据加上共享锁。共享锁可以同时加多个

+ 排它锁

  写锁，当用户进行数据写入时，对数据加上排他锁。排它锁只能加单个，和其它锁相斥，共享锁都相斥

### 死锁

**死锁是指多个事务在同一个资源上相互占用，并请求锁定对方资源导致的恶性循环的现象**

解决方案：

1. 如果是不同程序并发读取多个表，尽量约定以相同的顺序访问表
2. 同一事务中一次锁定所有资源
3. 升级锁粒度，通过表级锁来减少产生死锁的概率

### 乐观锁和悲观锁

+ 悲观锁：假设一定会发生冲突。在查询完数据的时候就把事务锁起来，直到提交事务。实现方式：**数据库中的锁机制**
+ 乐观锁：假设不会发生冲突。只在提交操作时检查是否违反数据完整性。在修改数据时把事务锁起来，通过version的方式进行锁定。实现方式：**版本号机制或者CAS算法实现**