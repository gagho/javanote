# 面试点二：缓存

缓存的作用：高性能、高并发

高性能：查询数据快，返回数据快速

高并发：缓存是走内存的，天然支持大量并发，数据库有连接限制

## Redis

### Redis的线程模型

单线程NIO异步的线程模型

事件处理器：

+ 连接应答处理器

  创建一个socket建立与客户端的连接

+ 命令请求处理器

  处理socket传过来的key和value

+ 命令回复处理器

#### 客户端与redis的一次通信流程

1. 客户端连接到redis的server socket请求建立连接
2. server socket产生一个AE_READABLES事件
3. IO多路复用程序监听所有的socket事件，并将监听到的时间压入队列中
4. 文件事件分派器会从队列中拿到事件，根据事件去找到对应的事件处理器（连接应答处理器）
5. 创建一个新的socket01，与客户端进行连接，并将socket01与命令请求处理器关联起来
6. 发送指令时，会重复以上操作，事件处理器更换成命令请求处理器，还会产生一个AE_WRITABLE事件
7. 根据命令对redis里的数据进行查询和操作
8. redis将事件AE_WRITABLE和命令回复处理器进行关联
9. 返回此次操作的结果
10. redis将事件AE_WRITABLE和命令回复处理器解除关联

#### redis的效率为什么这么高

1. 纯内存操作
2. 核心是基于非阻塞IO的多路复用机制
3. 单线程反而避免了多线程的频繁上下文切换问题

### redis数据类型及场景

+ String

  最基本的类型，普通的set和get，最简单的kv缓存

+ hash

  类似map的结构，缓存对象（非嵌套对象），每次写的时候可以操作里面的某个字段，

+ list

  有序列表，有序且可重复，可以存储一些列表型的数据结构，粉丝列表、评论列表，可以通过lrange命令进行数据个数读取（分页），也可以做简单队列

+ set

  无序集合，自动去重，共同好友类的功能(交集、并集、差集（api）)

+ sorted set(zset)

  排序的set，有一个分数可以进行排序，排行榜功能

  